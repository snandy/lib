<!DOCTYPE html>
<html>

	<head>
    	<meta charset='utf-8' />
    	<meta http-equiv="X-UA-Compatible" content="chrome=1" />
    	<title>jQuery Dialog</title>
    	<script src="http://ajax.aspnetcdn.com/ajax/jQuery/jquery-1.8.3.js"></script>
  	</head>
	<body>
		<script>
function fn1() {
	alert('done1')
}
function fn2() {
	alert('done2')
}
function fn3() {
	alert('all done')
}

var deferred1 = $.Deferred()
var deferred2 = $.Deferred()

deferred1.done(fn1)
deferred2.done(fn2)
$.when(deferred1, deferred2).done(fn3)

// setTimeout(function() {
	// deferred1.resolve()
	// deferred2.resolve()
// }, 3000)
//deferred.then(fn1, fn2, fn3)


// 观察者模式
var observer = {
	hash: {},
	subscribe: function(id, callback) {
		if (typeof id !== 'string') {
			return
		}
		if (!this.hash[id]) {
			this.hash[id] = $.Callbacks()
			this.hash[id].add(callback)
		} else {
			this.hash[id].add(callback)
		}
	},
	publish: function(id) {
		if (!this.hash[id]) {
			return
		}
		this.hash[id].fire(id)
	}
}

// 订阅
observer.subscribe('mailArrived', function() {
	alert('来信了')
})
observer.subscribe('mailArrived', function() {
	alert('又来信了')
})
observer.subscribe('mailSend', function() {
	alert('发信成功')
})

// 发布
setTimeout(function() {
	observer.publish('mailArrived')
}, 5000)
setTimeout(function() {
	observer.publish('mailSend')
}, 10000)

		</script>
	</body>
</html>
