<!doctype html>
<html>
<head>
	<style>
		td{width:30px;height:30px;text-align:center}
	</style>
	<script src="jquery-1.10.0.js"></script>
</head>
<body>
<script>
var $w = function(s){document.write(s)}

//x, y坐标绝对值最大数为层 l
function calculateLayer(x, y) {
    return Math.max(Math.abs(x), Math.abs(y));
}

//分成4个边，右下左上
function calculateSideAndLayer(x, y) {
    var l = calculateLayer(x, y)
    var s = 1 //边的编号，默认为右边

    if (-y == l && x >= y && x != l) //下边
        s = 2;
    else if(-x == l && x < y) //左边
        s = 3;
    else if(y == l && x <= y) //上边
        s = 4;

    return {side: s, layer: l}
}

//每个边按规律分段计算展开数
function sideNum(x, y) {
    // console.log(x, ', ', y)
    var obj = calculateSideAndLayer(x, y)
    var s = obj.side
    var l = obj.layer
    
    //层l的最大可容纳数为l * 8
    var maxNum = l * 8

    //层l最大数为 4l(l+1)
    var max = 4 * l * (l + 1)
  
    //每个边的最大数
    var temp = l * (s * 2 - 1)

    if (s == 1)
        temp = temp - y //1 随y递减递增
    else if(s == 2)
        temp = temp - x //2 随x递减递增
    else if(s == 3)
        temp = temp + y //3 随y递增递增
    else
        temp = temp + x //4 随x递增递增

    return temp + max - maxNum
}

//初始化大小
var n = 4;
var arr = [];
for (var i = 0; i < n; i++) {
    arr.push([]);
}
//中点位置，(n - 0.1)取奇数的中点
//坐标系平移到中点，并采用笛卡尔坐标系
//(x-mid, mid-y)
var mid = Math.floor((n - 0.1)/2)

function render() {
    var temp = []
    var start = '<table>'
    var end = '</table>'
    for (var i = 0; i < n; i++) {
		    var str = '<tr>'
		    for (var j = 0; j < n; j++) {
            console.log(i, ', ', j)
            var num = arr[i][j] = sideNum(j-mid, mid-i)
	    	    str += ('<td>' + num + '</td>')
        }
        str += '</tr>'
        temp.push(str)
	}
	var table = start + temp.join('') + end
	$w(table)
}
render()
</script>
</body>
</html>
